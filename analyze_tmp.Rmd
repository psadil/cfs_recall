---
title: "analyze_tmp"
author: "psadil"
date: "April 25, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(magrittr)
library(R.matlab)
library(stringdist)
library(Hmisc)

cutoff <- 1

source(file.path('utils.R'))
targets <- read_csv('objectNames_2afc.csv') 

out <- list()
for (i in 1:dim(targets[1])){
  out[i] = list(c(targets[i,]$name1,targets[i,]$name2,targets[i,]$name3,targets[i,]$name4,targets[i,]$name5,targets[i,]$name6,targets[i,]$name7,targets[i,]$name8,targets[i,]$name9,targets[i,]$name10))
}



cbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

Conditions = c('Not Studied','CFS, Image', 'Binocular, Image')

colmap <- c('Not Studied'=cbPalette[7]
            ,'Word'=cbPalette[2]
            ,'CFS, Image'=cbPalette[3]
            ,'Binocular, Image'=cbPalette[4])

```

Exemplary participants
Subject...
 - 2 didn't give any responses during the test
 - 3 left experiment after second list
 - 4 didn't give any responses
 - 5 didn't give any responses
 - 1,6,7 all gave responses





```{r loadData}



files <- Sys.glob(file.path("analyses","data","subject*","CFSRecall","*.csv"))
files <- files[2:length(files)]

d <- lapply(files, read_csv, col_types=cols(pas_1=col_character(),pas_2=col_character())) %>% 
  bind_rows() %>%
  select(subject,list,tType,item_test,pair_test,tType_test,swap_test,mm_answer,response_cue,response_noise,rt_noise) %>%
  filter(subject!=3) %>%
  rename(condition = tType) %>%
  mutate(targets = out[item_test]) %>%
  # mutate(targets = sapply(X=targets, FUN=function(x) unname(unlist(x)))) %>%
  mutate(firstTarget=sapply(X=targets, FUN=function(x) extract2(x,1))) %>%
  mutate(dl = Map(function(x,y) stringdist(x, y, method="dl"), targets, response_cue)) %>%
  mutate(minDist = sapply(X=dl, FUN=function(x) min(x, na.rm=TRUE))) %>%
  mutate(cue_correct = if_else(minDist<cutoff, 1, 0)) %>%
  mutate(mmm_correct = if_else(mm_answer==response_noise, 1, 0)) %>%
  mutate(subject = factor(subject)) %>%
  mutate(list = factor(list)) %>%
  mutate(condition = replace(condition, condition %in% c('NOT STUDIED','CFS','BINOCULAR'), c('Not Studied','CFS, Image', 'Binocular, Image'))) %>%
  mutate(condition = factor(condition, levels =c('Not Studied','CFS, Image','Binocular, Image')))


```

```{r naming}

'%!in%' <- function(x,y)!('%in%'(x,y))

d %>%
  filter(subject %!in% c(2,3,4,5)) %>%
  ggplot(aes(x=condition, y=cue_correct)) +
  stat_summary(fun.data="mean_cl_boot") +
  facet_grid(subject~.)


```

```{r mmm}

d %>%
  # filter(subject %!in% c(2,3,4,5)) %>%
  ggplot(aes(x=condition, y=mmm_correct)) +
  stat_summary(fun.data="mean_cl_boot") +
  facet_grid(subject~.)

```

```{r noise_rt}

d %>%
  # filter(subject %!in% c(2,3,4,5)) %>%
  ggplot(aes(x=condition, y=rt_noise, fill=condition)) +
  scale_y_continuous(limits = c(0,12)) +
  scale_fill_manual(values=colmap, name= "Condition") +
  geom_violin() +
  facet_grid(subject~.)

```

